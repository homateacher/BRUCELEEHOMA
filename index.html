<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ìò∏ÎßàÎß® Î™ÖÏñ∏ Í≥µÎ∂Ä</title>
    <style>
      :root {
        --card-grad-a: #fffdfa;
        --card-grad-b: #fff7ea;
        --card-grad-c: #fff3de;
        --ink: #2b2b2b;
        --ink-mute: #6b675d;
        --border: #d8cbb2;
      }
      * { box-sizing: border-box; }
      body {
        font-family: Pretendard, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        color: var(--ink);
        background: #f8f6f1;
        margin: 0; padding: 20px;
        display: flex; flex-direction: column; align-items: center; gap: 12px;
      }
      h1 { font-size: 28px; font-weight: 800; margin: 6px 0 10px; text-align:center; }
      .toolbar {
        display:flex; gap:8px; flex-wrap:wrap; justify-content:center; align-items:center;
      }
      .toolbar button, .toolbar label {
        border-radius: 10px; border: 1px solid var(--border);
        padding: 8px 12px; background: #fefcf7; font-size: 14px;
      }
      .scene { width: 92vw; max-width: 640px; height: 340px; perspective: 1000px; cursor: pointer; }
      .card {
        width: 100%; height: 100%; position: relative;
        transition: transform 0.8s ease-in-out;
        transform-style: preserve-3d;
        border-radius: 22px;
        box-shadow: 0 12px 28px rgba(0,0,0,0.08), 0 6px 14px rgba(0,0,0,0.05);
        border: 1px solid var(--border);
      }
      .is-flipped { transform: rotateY(180deg); }
      .card__face {
        position: absolute; inset: 0; display: flex; flex-direction: column;
        align-items: center; justify-content: center; text-align: center; padding: 22px;
        backface-visibility: hidden; border-radius: 22px;
        background: linear-gradient(145deg, var(--card-grad-a) 0%, var(--card-grad-b) 50%, var(--card-grad-c) 100%);
      }
      #front { font-size: 22px; font-weight: 700; }
      #back  { font-size: 18px; line-height: 1.45; }
      .origin { margin-top: 10px; font-size: 14px; color: var(--ink-mute); }
      .navs { display:flex; gap:10px; margin-top: 8px; }
      .navs button {
        border-radius: 10px; border: 1px solid var(--border);
        padding: 8px 14px; background:#fefcf7; font-size: 14px;
      }
      .meta { font-size: 13px; color: var(--ink-mute); margin-top: 2px; }
      @media (max-width: 420px){
        #front { font-size: 20px; }
        #back  { font-size: 17px; }
      }
    </style>
  </head>
  <body>
    <h1>üåü Ìò∏ÎßàÎß® Î™ÖÏñ∏ Í≥µÎ∂Ä üåü</h1>

    <div class="toolbar">
      <button id="shuffle">üîÄ ÏÖîÌîå</button>
      <button id="flip">‚Ü©Ô∏è Îí§ÏßëÍ∏∞</button>
      <label><input type="checkbox" id="soundToggle" checked /> ÏÇ¨Ïö¥Îìú</label>
    </div>

    <div class="scene" id="scene" title="Ïπ¥ÎìúÎ•º ÌÅ¥Î¶≠Ìï¥ Îí§ÏßëÍ∏∞">
      <div class="card" id="card">
        <div class="card__face" id="front">Ïò§ÎäòÏùò Î™ÖÏñ∏ Í≥µÎ∂Ä ‚ú®</div>
        <div class="card__face" id="back" style="transform: rotateY(180deg)"></div>
      </div>
    </div>

    <div class="navs">
      <button id="prev">‚óÄ Ïù¥Ï†Ñ</button>
      <button id="next">Îã§Ïùå ‚ñ∂</button>
    </div>
    <div class="meta" id="meta"></div>

    <script>
      async function loadData(){
        const res = await fetch('truth_quotes_300.json', { cache: 'no-store' });
        if(!res.ok){ alert('Î™ÖÏñ∏ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§. truth_quotes_300.jsonÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.'); return; }
        const idioms = await res.json();

        const card  = document.getElementById('card');
        const front = document.getElementById('front');
        const back  = document.getElementById('back');
        const meta  = document.getElementById('meta');
        const soundToggle = document.getElementById('soundToggle');

        let idx = 0;

        const randShuffle = (arr) => {
          for(let i = arr.length - 1; i > 0; i--){
            const j = Math.floor(Math.random()*(i+1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
          }
          return arr;
        };

        function playSound(){
          if(!soundToggle.checked) return;
          const ctx = new (window.AudioContext || window.webkitAudioContext)();
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          const now = ctx.currentTime;
          osc.type = 'triangle';
          osc.frequency.setValueAtTime(300, now);
          osc.frequency.exponentialRampToValueAtTime(800, now + 0.15);
          gain.gain.setValueAtTime(0.2, now);
          gain.gain.exponentialRampToValueAtTime(0.001, now + 0.15);
          osc.connect(gain).connect(ctx.destination);
          osc.start(now); osc.stop(now + 0.15);
        }

        function renderFront(){
          const cur = idioms[idx];
          front.innerHTML = `<div>${cur.term}</div>`;
          meta.textContent = `${idx+1}/${idioms.length}`;
        }
        function renderBack(){
          const cur = idioms[idx];
          back.innerHTML = `<div>${cur.meaning}</div><div class="origin">${cur.origin || ''}</div>`;
          meta.textContent = `${idx+1}/${idioms.length}`;
        }

        function updateCard(){
          if(card.classList.contains('is-flipped')) {
            renderBack();
          } else {
            renderFront();
          }
          playSound();
        }

        renderFront(); renderBack(); meta.textContent = `1/${idioms.length}`;

        document.getElementById('flip').onclick = () => {
          card.classList.toggle('is-flipped');
          updateCard();
        };
        document.getElementById('scene').onclick = () => {
          card.classList.toggle('is-flipped');
          updateCard();
        };

        document.getElementById('next').onclick = () => {
          idx = (idx + 1) % idioms.length;
          updateCard();
        };
        document.getElementById('prev').onclick = () => {
          idx = (idx - 1 + idioms.length) % idioms.length;
          updateCard();
        };
        document.getElementById('shuffle').onclick = () => {
          randShuffle(idioms);
          idx = 0;
          updateCard();
        };

        window.addEventListener('keydown', (e) => {
          if(e.key === 'ArrowRight') { document.getElementById('next').click(); }
          if(e.key === 'ArrowLeft')  { document.getElementById('prev').click(); }
          if(e.key === ' ') { e.preventDefault(); document.getElementById('flip').click(); }
        });
      }

      loadData();
    </script>
  </body>
</html>
